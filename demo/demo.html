<!DOCTYPE html>
<html>
    <head>
        <title>ULabel</title>
        <link rel="stylesheet" href="/ulabel.css">
        <link rel="icon" href="https://sentera.com/wp-content/uploads/2018/03/Favicon.png" sizes="192x192" />

        <!-- Dependencies from cdn -->
        <script
            src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>

        <!-- ULabel Library -->
        <script src="/ulabel.js"></script>

        <!-- ULabel Usage -->
        <script type="module">
            /* global $ */
            /* global ULabel */
            /* global uuidv4 */

            $(document).ready(function() {
                function on_save(annotations) {
                    console.log("Save");
                    console.log(JSON.stringify(annotations, null, 2));
                }

                function on_exit(annotations) {
                    console.log("Exit");
                    console.log(JSON.stringify(annotations, null, 2));
                }

                function on_done(annotations) {
                    console.log("Done");
                    var element = document.createElement('a');
                    element.setAttribute("href", 'data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(annotations, null, 2)));
                    element.setAttribute("download", "annotations.json");
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                }

                // Initial ULabel configuration
                let ulabel = new ULabel(
                    "container", // ID of container to build ULabel inside
                    "/demo_image.jpg", // Image to annotate
                    "TestUser", // User ID
                    [
                        {
                            "type": "class",
                            "id": 2
                        }
                    ], // Taxonomy
                    {
                        "1": {
                            "name": "Weed",
                            "color": "orange"
                        }
                    }, // Class Definitions
                    on_save, // Save callback
                    on_exit, // Exit callback
                    on_done, // Done callback
                    ["polygon", "bbox", "contour"], // Allowed annotation modes
                    null, // Resume from
                    {
                        "task_id": uuidv4(),
                        "batch_id": uuidv4(),
                        "image_id": uuidv4()
                    } // meta
                );

                // Wait for ULabel instance to finish initialization
                ulabel.init(function() {
                    // ULabel is now ready for use
                });

            });
        </script>
    </head>
    <body>
        <div id="container" style="width: 100%; height: 100vh; position: absolute; top: 0; left: 0;"></div>
    </body>
</html>